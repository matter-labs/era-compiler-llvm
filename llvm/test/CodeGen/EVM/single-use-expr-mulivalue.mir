# RUN: llc -x mir -run-pass evm-single-use-expressions -verify-machineinstrs < %s | FileCheck %s

--- |

  target datalayout = "E-p:256:256-i256:256:256-S256-a:256:256"
  target triple = "evm"
  declare void @multival()
  define void @dont_move_mulivalue() { ret void }

...
---
# This test ensures that we do not move FCALL instruction
# after the SIGNEXTEND one.
#
# CHECK-LABEL: bb.1:
# CHECK: %3:gpr, %4:gpr = FCALL @multival, %0
# CHECK-NEXT: %5:gpr = SIGNEXTEND %1, %4
# CHECK-NEXT: %6:gpr = AND %3, %2
name: dont_move_mulivalue
tracksRegLiveness: true
registers:
 - { id: 0, class: gpr }
body:             |
  bb.0:

  %0:gpr = SELFBALANCE implicit-def dead $arguments
  %1:gpr = SELFBALANCE implicit-def dead $arguments
  %2:gpr = SELFBALANCE implicit-def dead $arguments

  bb.1:

  %3:gpr, %4:gpr = FCALL @multival, %0:gpr, implicit-def dead $arguments, implicit $sp
  %5:gpr = SIGNEXTEND %1:gpr, %4:gpr, implicit-def dead $arguments
  %6:gpr = AND %3:gpr, %2:gpr, implicit-def dead $arguments

  bb.2:

  RET %5:gpr, %6:gpr
...
